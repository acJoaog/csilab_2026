# Configuração MQTT com TLS
persistence true
persistence_location /mosquitto/data/
log_dest stdout

# Autenticação (apenas controle - sem autenticação de dispositivos)
allow_anonymous true

# Portas e protocolos
listener 8883 0.0.0.0
protocol mqtt
max_connections 100

# Configurações TLS
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key
tls_version tlsv1.2
require_certificate true
use_identity_as_username false

# WebSocket para interface web
listener 9001 0.0.0.0
protocol websockets
cafile /mosquitto/certs/ca.crt
certfile /mosquitto/certs/server.crt
keyfile /mosquitto/certs/server.key

# Otimizações
persistent_client_expiration 1h
max_queued_messages 1000
max_packet_size 10485760  # 10MB